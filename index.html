<!DOCTYPE html>
<html lang="wo" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gaganti Pro - Waxukaay Wolof</title>
  <link rel="preload" href="gaganti.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --noir: #0a0a0a;
      --or: #D4AF37;
      --terre: #7c4d1e;
      --wolof: #F5F5DC;
      --vert-fonce: #013220;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }
    @font-face {
      font-family: 'Gaganti';
      src: url('gaganti.ttf') format('truetype');
      font-display: swap;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Gaganti', sans-serif;
      background-color: var(--noir);
      color: var(--wolof);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path fill="%23D4AF37" fill-opacity="0.03" d="M100,20 C120,60 180,80 180,120 C140,120 100,160 100,200 C100,160 60,120 20,120 C20,80 80,60 100,20 Z"/></svg>');
      background-size: 300px;
    }
    header {
      background: linear-gradient(to right, var(--noir), var(--vert-fonce));
      padding: 1.5rem;
      text-align: center;
      border-bottom: 2px solid var(--or);
      box-shadow: var(--shadow);
    }
    .logo {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
    }
    .logo-icon {
      font-size: 2.8rem;
      color: var(--or);
    }
    h1 {
      font-size: 2.5rem;
      background: linear-gradient(to right, var(--or), #F5DEB3);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 3px;
    }
    .main-nav {
      display: flex;
      justify-content: center;
      background-color: rgba(1, 50, 32, 0.8);
      border-bottom: 1px solid var(--or);
    }
    .nav-link {
      padding: 1.2rem 2.5rem;
      color: var(--wolof);
      text-decoration: none;
      font-size: 1.2rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .nav-link:hover {
      background-color: rgba(212, 175, 55, 0.1);
      color: var(--or);
    }
    .nav-link.active {
      background-color: rgba(212, 175, 55, 0.2);
      color: var(--or);
      border-bottom: 3px solid var(--or);
    }
    .main-content {
      display: none;
      flex: 1;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 95%;
    }
    .main-content.active {
      display: block;
    }
    .editor-container {
      background-color: rgba(10, 10, 10, 0.9);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 2.5rem;
      border: 1px solid var(--or);
      margin-bottom: 2rem;
    }
    #editor {
      width: 100%;
      min-height: 50vh;
      padding: 1.5rem;
      font-size: 1.8rem;
      background-color: transparent;
      color: var(--wolof);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      resize: none;
      font-family: 'Gaganti', sans-serif;
      text-align: right;
      direction: rtl;
      line-height: 1.8;
    }
    .editor-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      font-size: 1rem;
      color: var(--or);
    }
    .keyboard-container {
      background-color: rgba(10, 10, 10, 0.9);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 2rem;
      border: 1px solid var(--or);
      margin-bottom: 2rem;
    }
    .keyboard-title {
      font-size: 1.6rem;
      margin-bottom: 1.5rem;
      color: var(--or);
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .keyboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 1rem;
    }
    .keyboard button {
      height: 80px;
      font-size: 2rem;
      background-color: var(--vert-fonce);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Gaganti', sans-serif;
    }
    .keyboard button:hover {
      background-color: var(--or);
      color: var(--noir);
      transform: translateY(-3px);
    }
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    button {
      padding: 1.2rem;
      font-size: 1.2rem;
      background-color: var(--vert-fonce);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    button.accent {
      background-color: var(--or);
      color: var(--noir);
      font-weight: bold;
    }
    button.outline {
      background-color: transparent;
      border: 2px solid var(--or);
      color: var(--or);
    }
    .forum-container {
      display: flex;
      height: 70vh;
      background-color: rgba(10, 10, 10, 0.9);
      border-radius: 12px;
      box-shadow: var(--shadow);
      border: 1px solid var(--or);
      overflow: hidden;
    }
    .participants-sidebar {
      width: 250px;
      background-color: rgba(1, 65, 28, 0.2);
      border-left: 1px solid var(--or);
      padding: 1rem;
      overflow-y: auto;
    }
    .participant {
      display: flex;
      align-items: center;
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      transition: all 0.3s;
    }
    .participant:hover {
      background-color: rgba(212, 175, 55, 0.1);
    }
    .participant-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--or);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 1rem;
      font-weight: bold;
      color: var(--noir);
    }
    .participant-name {
      flex: 1;
    }
    .participant-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #888;
    }
    .participant-status.online {
      background-color: #4CAF50;
    }
    .messages-container {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      background-color: rgba(0, 0, 0, 0.2);
      direction: rtl;
    }
    .message {
      margin-bottom: 1.5rem;
      max-width: 70%;
      padding: 1rem;
      border-radius: 8px;
      position: relative;
    }
    .message.received {
      background-color: rgba(139, 69, 19, 0.3);
      margin-right: auto;
      border-right: 3px solid var(--or);
    }
    .message.sent {
      background-color: rgba(1, 65, 28, 0.3);
      margin-left: auto;
      border-left: 3px solid var(--or);
    }
    .message-header {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .message-sender {
      font-weight: bold;
      color: var(--or);
    }
    .message-time {
      font-size: 0.8rem;
      color: #aaa;
      margin-right: 1rem;
    }
    .message-content {
      font-size: 1.1rem;
      line-height: 1.5;
      font-family: 'Gaganti', sans-serif;
    }
    .chat-input-container {
      padding: 1rem;
      background-color: rgba(26, 26, 26, 0.9);
      border-top: 1px solid var(--or);
      display: flex;
      flex-direction: column;
    }
    .chat-input {
      width: 100%;
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--or);
      border-radius: 8px;
      color: var(--wolof);
      font-family: 'Gaganti', sans-serif;
      font-size: 1.1rem;
      resize: none;
      direction: rtl;
    }
    .send-button {
      align-self: flex-end;
      margin-top: 0.5rem;
      padding: 0.5rem 1.5rem;
      background-color: var(--or);
      color: var(--noir);
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: var(--noir);
      padding: 2rem;
      border-radius: 12px;
      border: 1px solid var(--or);
      width: 90%;
      max-width: 500px;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-input {
      width: 100%;
      padding: 0.8rem;
      background-color: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--or);
      border-radius: 6px;
      color: var(--wolof);
      font-family: 'Gaganti', sans-serif;
    }
    footer {
      background: linear-gradient(to right, var(--noir), var(--vert-fonce));
      color: white;
      text-align: center;
      padding: 2rem;
      margin-top: auto;
      border-top: 1px solid var(--or);
    }
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .footer-link {
      color: var(--or);
      text-decoration: none;
      transition: all 0.3s;
    }
    .footer-link:hover {
      color: white;
    }
    .copyright {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    @media (max-width: 992px) {
      .keyboard {
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
      }
      .keyboard button {
        height: 70px;
        font-size: 1.8rem;
      }
    }
    @media (max-width: 768px) {
      .forum-container {
        flex-direction: column;
        height: auto;
      }
      .participants-sidebar {
        width: 100%;
        border-left: none;
        border-bottom: 1px solid var(--or);
      }
      .message {
        max-width: 85%;
      }
      .nav-link {
        padding: 1rem;
      }
    }
    @media (max-width: 480px) {
      .keyboard {
        grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
      }
      .keyboard button {
        height: 50px;
        font-size: 1.4rem;
      }
      button {
        padding: 1rem;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <span class="logo-icon">‚úçÔ∏è</span>
      <h1>Gaganti Pro</h1>
    </div>
  </header>

  <nav class="main-nav">
    <a href="#" class="nav-link active" id="editor-link">
      <i class="fas fa-edit"></i> Bindal
    </a>
    <a href="#" class="nav-link" id="forum-link">
      <i class="fas fa-users"></i> Mbooloo
    </a>
  </nav>

  <main class="main-content active" id="editor-section">
    <div class="editor-container">
      <textarea id="editor" placeholder="T√´ral noonu..."></textarea>
      <div class="editor-footer">
        <div class="character-count">0 xaraf</div>
        <button onclick="toggleFullscreen()" class="outline">
          <i class="fas fa-expand"></i> Ekraan bu bees
        </button>
      </div>
    </div>
    <div class="keyboard-container">
      <h2 class="keyboard-title">
        <i class="fas fa-keyboard"></i> Clavier bu Gaganti
      </h2>
      <div class="keyboard">
        <button onclick="insertAtCursor('û§Ä')">û§Ä</button>
        <button onclick="insertAtCursor('û§Å')">û§Å</button>
        <button onclick="insertAtCursor('û§Ç')">û§Ç</button>
        <button onclick="insertAtCursor('û§É')">û§É</button>
        <button onclick="insertAtCursor('û§Ñ')">û§Ñ</button>
        <button onclick="insertAtCursor('û§Ö')">û§Ö</button>
        <button onclick="insertAtCursor('û§Ü')">û§Ü</button>
        <button onclick="insertAtCursor('û§á')">û§á</button>
        <button onclick="insertAtCursor('û§à')">û§à</button>
        <button onclick="insertAtCursor('û§â')">û§â</button>
        <button onclick="insertAtCursor('û§ä')">û§ä</button>
        <button onclick="insertAtCursor('û§ã')">û§ã</button>
        <button onclick="insertAtCursor('û§å')">û§å</button>
        <button onclick="insertAtCursor('û§ç')">û§ç</button>
        <button onclick="insertAtCursor('û§é')">û§é</button>
        <button onclick="insertAtCursor('û§è')">û§è</button>
        <button onclick="insertAtCursor('û§ê')">û§ê</button>
        <button onclick="insertAtCursor('û§ë')">û§ë</button>
        <button onclick="insertAtCursor('û§í')">û§í</button>
        <button onclick="insertAtCursor('û§ì')">û§ì</button>
        <button onclick="insertAtCursor('û§î')">û§î</button>
        <button onclick="insertAtCursor('û§ï')">û§ï</button>
        <button onclick="insertAtCursor('û§ñ')">û§ñ</button>
        <button onclick="insertAtCursor('û§ó')">û§ó</button>
        <button onclick="insertAtCursor('û§ò')">û§ò</button>
        <button onclick="insertAtCursor('û§ô')">û§ô</button>
        <button onclick="insertAtCursor('û§ö')">û§ö</button>
        <button onclick="insertAtCursor('û§õ')">û§õ</button>
        <button onclick="insertAtCursor('û•û')">û•û</button>
        <button onclick="insertAtCursor('û•ü')">û•ü</button>
        <button onclick="insertAtCursor(' ')">‚ê£</button>
        <button onclick="insertAtCursor('\n')">‚Üµ</button>
        <button onclick="deleteChar()" class="accent"><i class="fas fa-backspace"></i></button>
      </div>
    </div>
    <div class="action-buttons">
      <button onclick="copyText()" class="secondary">
        <i class="fas fa-copy"></i> N√†√±√±
      </button>
      <button onclick="downloadText()" class="secondary">
        <i class="fas fa-file-alt"></i> Export ci TXT
      </button>
      <button onclick="downloadPDF()" class="accent">
        <i class="fas fa-file-pdf"></i> Export ci PDF
      </button>
      <button onclick="clearText()" class="outline">
        <i class="fas fa-trash-alt"></i> F√†yyi
      </button>
    </div>
  </main>

  <main class="main-content" id="forum-section">
    <div class="forum-container">
      <div class="messages-container" id="messages-container">
        <!-- Messages seront ajout√©s ici -->
      </div>
      <div class="participants-sidebar">
        <h3>J√´fandikoo bi <span id="online-count">(0 ci kaw)</span></h3>
        <div id="participants-list">
          <!-- Participants seront ajout√©s ici -->
        </div>
      </div>
    </div>
    <div class="chat-input-container">
      <textarea class="chat-input" id="chat-input" placeholder="Bindal message bi..."></textarea>
      <button class="send-button" onclick="sendMessage()">
        <i class="fas fa-paper-plane"></i> Y√≥nn√©
      </button>
    </div>
  </main>

  <div class="modal-overlay" id="login-modal">
    <div class="modal-content">
      <h2 class="keyboard-title" style="text-align: center; margin-bottom: 1.5rem;">
        <i class="fas fa-user-circle"></i> S√†kku ci Mbooloo
      </h2>
      <div class="form-group">
        <input type="text" class="form-input" id="user-name" placeholder="Tur wi">
      </div>
      <div class="form-group">
        <input type="text" class="form-input" id="user-pronoun" placeholder="Pronom (g√≥or/jig√©en/...)">
      </div>
      <button class="send-button" style="width: 100%;" onclick="joinForum()">
        <i class="fas fa-sign-in-alt"></i> Dugg
      </button>
    </div>
  </div>

  <footer>
    <div class="footer-links">
      <a href="#" class="footer-link">Ci lii la</a>
      <a href="#" class="footer-link">Jukki</a>
      <a href="#" class="footer-link">Natteef</a>
      <a href="#" class="footer-link">Gis nu</a>
    </div>
    <div class="copyright">
      &copy; 2023 Gaganti Pro - Waxukaay Wolof
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "VOTRE_API_KEY",
      authDomain: "VOTRE_AUTH_DOMAIN",
      projectId: "VOTRE_PROJECT_ID",
      storageBucket: "VOTRE_STORAGE_BUCKET",
      messagingSenderId: "VOTRE_MESSAGING_SENDER_ID",
      appId: "VOTRE_APP_ID"
    };

    // Initialiser Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Variables globales
    let currentUser = null;
    let participants = [];
    let messages = [];

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      updateCharacterCount();
      document.getElementById('editor').addEventListener('input', updateCharacterCount);

      // Gestionnaires de navigation
      document.getElementById('editor-link').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('editor');
      });

      document.getElementById('forum-link').addEventListener('click', function(e) {
        e.preventDefault();
        showSection('forum');
      });

      // √âcouter les changements d'authentification
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = {
            id: user.uid,
            name: user.displayName || "Utilisateur",
            pronoun: "g√≥or",
            avatar: (user.displayName || "U").charAt(0).toUpperCase(),
            online: true
          };
          loadMessages();
        } else {
          currentUser = null;
        }
      });
    });

    // Navigation entre sections
    function showSection(sectionId) {
      document.querySelectorAll('.main-content').forEach(section => {
        section.classList.remove('active');
      });

      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });

      document.getElementById(sectionId + '-section').classList.add('active');
      document.getElementById(sectionId + '-link').classList.add('active');

      if (sectionId === 'forum' && !currentUser) {
        document.getElementById('login-modal').style.display = 'flex';
      } else {
        document.getElementById('login-modal').style.display = 'none';
      }
    }

    // === FONCTIONS √âDITEUR ===
    function insertAtCursor(char) {
      const editor = document.getElementById('editor');
      const cursorPos = editor.selectionStart;
      const text = editor.value;

      editor.value = text.substring(0, cursorPos) + char + text.substring(cursorPos);
      editor.selectionStart = editor.selectionEnd = cursorPos + char.length;

      updateCharacterCount();
      editor.focus();
    }

    function deleteChar() {
      const editor = document.getElementById('editor');
      const cursorPos = editor.selectionStart;
      const text = editor.value;

      if (cursorPos > 0) {
        editor.value = text.substring(0, cursorPos - 1) + text.substring(cursorPos);
        editor.selectionStart = editor.selectionEnd = cursorPos - 1;
        updateCharacterCount();
      }
      editor.focus();
    }

    function updateCharacterCount() {
      const editor = document.getElementById('editor');
      const count = editor.value.length;
      document.querySelector('.character-count').textContent = `${count} xaraf`;
    }

    function copyText() {
      const textArea = document.getElementById('editor');
      navigator.clipboard.writeText(textArea.value)
        .then(() => alert('Bindal bi n√†√±√± na!'))
        .catch(err => alert('J√†pp na j√†pp ci n√†√±√± bi'));
    }

    function downloadText() {
      const text = document.getElementById('editor').value;
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `gaganti-${new Date().toISOString().slice(0,10)}.txt`;
      link.click();
      alert('Bindal bi sosoo na ci fichier TXT');
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: "a4"
      });

      const text = document.getElementById('editor').value;
      const lines = doc.splitTextToSize(text, 180);

      doc.setFontSize(12);
      doc.text(lines, 200, 20, { align: 'right' });

      doc.setFontSize(10);
      doc.setTextColor(100);
      doc.text('Bindal bu Gaganti Pro - Waxukaay Wolof', 105, 10, { align: 'center' });

      doc.save(`gaganti-${new Date().toISOString().slice(0,10)}.pdf`);
      alert('PDF bi g√©n√©r√© na');
    }

    function clearText() {
      if (confirm('Danga b√´gg f√†yyi bindal bi ci d√´gg?')) {
        document.getElementById('editor').value = '';
        updateCharacterCount();
        alert('Bindal bi f√†yyi na');
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    // === FONCTIONS FORUM ===
    function joinForum() {
      const userName = document.getElementById('user-name').value;
      const userPronoun = document.getElementById('user-pronoun').value;

      if (!userName || !userPronoun) {
        alert('F√†ww nga bind tur ak pronom');
        return;
      }

      auth.signInAnonymously()
        .then(() => {
          const user = auth.currentUser;
          user.updateProfile({
            displayName: userName
          }).then(() => {
            currentUser = {
              id: user.uid,
              name: userName,
              pronoun: userPronoun,
              avatar: userName.charAt(0).toUpperCase(),
              online: true
            };

            // Ajouter un message de bienvenue
            const welcomeMessage = {
              senderId: currentUser.id,
              senderName: currentUser.name,
              content: `${userName} dugg na ci mbooloo mi!`,
              timestamp: new Date(),
              type: 'system'
            };

            db.collection("messages").add(welcomeMessage);
            document.getElementById('login-modal').style.display = 'none';
          });
        })
        .catch((error) => {
          console.error("Erreur d'authentification: ", error);
        });
    }

    function loadMessages() {
      db.collection("messages")
        .orderBy("timestamp")
        .onSnapshot((querySnapshot) => {
          messages = [];
          querySnapshot.forEach((doc) => {
            messages.push(doc.data());
          });
          updateMessages();
        });

      // √âcouter les participants en ligne
      db.collection("participants").onSnapshot((querySnapshot) => {
        participants = [];
        querySnapshot.forEach((doc) => {
          participants.push(doc.data());
        });
        updateParticipantsList();
      });

      // Ajouter le participant actuel
      if (currentUser) {
        db.collection("participants").doc(currentUser.id).set({
          id: currentUser.id,
          name: currentUser.name,
          pronoun: currentUser.pronoun,
          avatar: currentUser.avatar,
          online: true
        });
      }
    }

    function updateParticipantsList() {
      const container = document.getElementById('participants-list');
      const onlineCount = participants.filter(p => p.online).length;

      document.getElementById('online-count').textContent = `(${onlineCount} ci kaw)`;
      container.innerHTML = '';

      participants.forEach(participant => {
        const participantEl = document.createElement('div');
        participantEl.className = 'participant';
        participantEl.innerHTML = `
          <div class="participant-avatar">${participant.avatar}</div>
          <div class="participant-name">
            ${participant.name} <small>(${participant.pronoun})</small>
          </div>
          <div class="participant-status ${participant.online ? 'online' : ''}"></div>
        `;

        container.appendChild(participantEl);
      });
    }

    function updateMessages() {
      const container = document.getElementById('messages-container');
      container.innerHTML = '';

      messages.forEach(message => {
        const isCurrentUser = currentUser && message.senderId === currentUser.id;
        const isSystem = message.type === 'system';

        if (isSystem) {
          const systemMsg = document.createElement('div');
          systemMsg.className = 'message system';
          systemMsg.innerHTML = `
            <div style="text-align: center; color: var(--or);">
              ${message.content}
            </div>
          `;
          container.appendChild(systemMsg);
          return;
        }

        const messageEl = document.createElement('div');
        messageEl.className = `message ${isCurrentUser ? 'sent' : 'received'}`;

        messageEl.innerHTML = `
          <div class="message-header">
            <div class="message-sender">${message.senderName}</div>
            <div class="message-time">${formatTime(message.timestamp)}</div>
          </div>
          <div class="message-content">${message.content}</div>
        `;

        container.appendChild(messageEl);
      });

      container.scrollTop = container.scrollHeight;
    }

    function formatTime(date) {
      if (date instanceof firebase.firestore.Timestamp) {
        date = date.toDate();
      }
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function sendMessage() {
      const input = document.getElementById('chat-input');
      const content = input.value.trim();

      if (!content || !currentUser) return;

      const newMessage = {
        senderId: currentUser.id,
        senderName: currentUser.name,
        content: content,
        timestamp: new Date(),
        type: 'text'
      };

      db.collection("messages").add(newMessage);
      input.value = '';
    }
  </script>
</body>
</html>
