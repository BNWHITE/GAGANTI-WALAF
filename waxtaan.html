<!DOCTYPE html>
<html lang="wo" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Waxtaan ci Gagganti</title>
  <link rel="preload" href="gagganti.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --noir: #0a0a0a;
      --or: #D4AF37;
      --ivoire: #F5F5DC;
      --indigo: #4B0082;
    }

    @font-face {
      font-family: 'Gagganti';
      src: url('gagganti.ttf') format('truetype');
      font-display: swap;
    }

    body {
      font-family: 'Gagganti', sans-serif;
      background: linear-gradient(to left, var(--noir), var(--indigo));
      color: var(--ivoire);
      margin: 0;
      padding: 0;
      direction: rtl;
    }

    .chat-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
    }

    .chat-header {
      text-align: center;
      padding: 1rem;
      border-bottom: 2px solid var(--or);
    }

    #messages {
      height: 60vh;
      overflow-y: auto;
      border: 1px solid var(--or);
      padding: 1rem;
      margin: 1rem 0;
    }

    .chat-input {
      display: flex;
      gap: 0.5rem;
    }

    #message-input {
      flex: 1;
      padding: 1rem;
      background: rgba(212, 175, 55, 0.1);
      border: 1px solid var(--or);
      color: var(--ivoire);
    }

    #send-btn {
      padding: 0 1.5rem;
      background: var(--or);
      color: var(--noir);
      border: none;
      cursor: pointer;
    }

    .message {
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border-right: 3px solid var(--or);
    }

    .back-btn {
      display: inline-block;
      margin: 1rem;
      color: var(--or);
      text-decoration: none;
    }

    @media (max-width: 768px) {
      #messages {
        height: 50vh;
      }
    }
  </style>
</head>
<body>
  <a href="index.html" class="back-btn">
    <i class="fas fa-arrow-left"></i> Déggal
  </a>

  <div class="chat-container">
    <div class="chat-header">
      <h1><i class="fas fa-comments"></i> Waxtaan ci Gagganti</h1>
    </div>
    
    <div id="messages"></div>
    
    <div class="chat-input">
      <input type="text" id="message-input" placeholder="Bindal xibaar bi..." dir="rtl">
      <button id="send-btn"><i class="fas fa-paper-plane"></i> Yónnee</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Connexion au serveur
    const socket = io();
    let username = '';
    
    // Demande du nom d'utilisateur
    while (!username.trim()) {
      username = prompt('Tapp tur wu matale :') || '';
    }
    
    // Gestion de l'envoi de messages
    document.getElementById('send-btn').addEventListener('click', sendMessage);
    document.getElementById('message-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });
    
    function sendMessage() {
      const input = document.getElementById('message-input');
      const text = input.value.trim();
      
      if (text) {
        const message = {
          user: username,
          text: text,
          time: new Date().toLocaleTimeString()
        };
        
        socket.emit('message', message);
        input.value = '';
        input.focus();
      }
    }
    
    // Affichage des messages
    socket.on('message', (msg) => {
      displayMessage(msg);
    });
    
    // Réception de l'historique
    socket.on('init', (messages) => {
      messages.forEach(msg => displayMessage(msg));
    });
    
    function displayMessage(msg) {
      const messagesDiv = document.getElementById('messages');
      const messageDiv = document.createElement('div');
      
      messageDiv.className = 'message';
      messageDiv.innerHTML = `
        <strong>${msg.user}:</strong> ${msg.text}
        <small style="color: var(--or);">${msg.time}</small>
      `;
      
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    // Focus automatique sur le champ de message
    document.getElementById('message-input').focus();
  </script>
</body>
</html>
