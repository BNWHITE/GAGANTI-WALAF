<!DOCTYPE html>
<html lang="wo" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Waxtaan ci Gagganti</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Gagganti';
      src: url('/mnt/data/gagganti.ttf') format('truetype');
      font-display: swap;
    }

    body {
      font-family: 'Gagganti', sans-serif;
      background-color: #121212;
      color: #f5f5f5;
      height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
    }

    .message-out {
      background-color: #2f2f4f;
      border-left: 4px solid #a78bfa;
    }

    .message-in {
      background-color: #1e1e2e;
      border-right: 4px solid #8b5cf6;
    }

    .message-time {
      font-size: 0.75rem;
      color: #999;
    }

    .reaction {
      font-size: 1rem;
      margin-left: 0.5rem;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .reaction:hover {
      transform: scale(1.3);
    }

    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    #input-container {
      display: flex;
      padding: 1rem;
      background: #1a1a1a;
      gap: 0.5rem;
    }

    #message-input {
      flex: 1;
      padding: 0.75rem;
      border-radius: 999px;
      border: none;
      background: #333;
      color: #fff;
    }

    #send-button {
      padding: 0.75rem 1.25rem;
      background-color: #4c1d95;
      color: white;
      border-radius: 999px;
    }

    .day-divider {
      text-align: center;
      font-size: 0.8rem;
      color: #aaa;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div id="messages" class="overflow-y-auto"></div>

  <div id="input-container">
    <input type="text" id="message-input" placeholder="Bindal ci..." autocomplete="off"></input>
    <button id="send-button">‚û°Ô∏è</button>
  </div>

  <script>
    const storedName = localStorage.getItem('gagganti_username') || prompt('Tapp tur wu matale :');
    const storedAvatar = localStorage.getItem('gagganti_avatar') || prompt('Entrer lien avatar (facultatif) :');
    localStorage.setItem('gagganti_username', storedName);
    localStorage.setItem('gagganti_avatar', storedAvatar);

    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-button');

    const chatHistory = JSON.parse(localStorage.getItem('gagganti_history')) || [];

    let lastDate = '';

    function formatDate(d) {
      const today = new Date();
      const target = new Date(d);
      if (target.toDateString() === today.toDateString()) return 'Tey';
      const yesterday = new Date();
      yesterday.setDate(today.getDate() - 1);
      if (target.toDateString() === yesterday.toDateString()) return 'D√©mb';
      return target.toLocaleDateString();
    }

    function renderMessage(msg) {
      const msgDate = new Date(msg.date).toDateString();
      if (msgDate !== lastDate) {
        const divider = document.createElement('div');
        divider.className = 'day-divider';
        divider.textContent = formatDate(msg.date);
        messagesEl.appendChild(divider);
        lastDate = msgDate;
      }

      const div = document.createElement('div');
      div.className = `max-w-xl px-4 py-2 mb-2 rounded-xl ${msg.outgoing ? 'message-out ml-auto text-right' : 'message-in mr-auto text-right'} relative`;
      div.innerHTML = `
        <div class="flex items-center gap-2 mb-1">
          ${msg.avatar ? `<img src="${msg.avatar}" alt="avatar" class="w-6 h-6 rounded-full">` : ''}
          <div class="font-bold text-purple-400">${msg.user}</div>
        </div>
        <div class="text-lg">${msg.text}</div>
        <div class="message-time">${new Date(msg.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
        <div class="flex gap-2 mt-1">
          <span class="reaction">‚ù§Ô∏è</span>
          <span class="reaction">üòÇ</span>
          <span class="reaction">üî•</span>
        </div>`;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    chatHistory.forEach(renderMessage);

    function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;
      const msg = {
        user: storedName,
        avatar: storedAvatar,
        text,
        date: new Date(),
        outgoing: true
      };
      chatHistory.push(msg);
      localStorage.setItem('gagganti_history', JSON.stringify(chatHistory));
      renderMessage(msg);
      inputEl.value = '';
    }

    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>
